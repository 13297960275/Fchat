{"version":3,"sources":["webpack://fonlineconsultation/./packages/recorder.js","webpack://fonlineconsultation/./packages/ios-weixin-config.js"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsB;AACtB;AACyD;AACA;AACI;AAChC;AACP;AACe;AACO;AACF;AACO;AACZ;AACU;AAC/C,0CAAG,KAAK,wEAAS;AACjB,0CAAG,wBAAwB,wEAAS,C;;;;;;;ACdpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB,mCAAmC,kDAAkD;AACrF,qCAAqC,kCAAkC;AACvE,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE;AACjE;AACA;AACA;AACA,4D;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,c;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,W;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA,kBAAkB,4EAA4E,kCAAkC,EAAE;AAClI;AACA;AACA,UAAU;AACV;AACA;AACA;AACA,UAAU,U;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,gCAAgC,oBAAoB;AACpD;AACA;AACA;AACA;AACA,iCAAiC,0BAA0B;AAC3D;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA,aAAa,mB;AACb;AACA,aAAa;AACb;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;;;;AAKD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E","file":"fonlineconsultation.common.2.js","sourcesContent":["import Vue from 'vue';\r\n/********先加载RecordApp需要用到的支持文件*********/\r\nimport RecordApp from 'recorder-core/src/app-support/app'\r\nimport 'recorder-core/src/app-support/app-native-support'\r\nimport 'recorder-core/src/app-support/app-ios-weixin-support'\r\nimport './ios-weixin-config';\r\nimport 'recorder-core'\r\nimport 'recorder-core/src/engine/mp3'\r\nimport 'recorder-core/src/engine/mp3-engine'\r\nimport 'recorder-core/src/engine/beta-amr'\r\nimport 'recorder-core/src/engine/beta-amr-engine'\r\nimport 'recorder-core/src/engine/wav'\r\nimport 'recorder-core/src/extensions/waveview';\r\nVue.use(RecordApp);\r\nVue.prototype.$RecordApp = RecordApp;","/*\r\napp-support/app.js中IOS-Weixin测试用的配置例子，用于支持ios的微信中使用微信JsSDK来录音\r\n【本文件的作用】：实现app.js内IOS-Weixin中Config的两个标注为需实现的接口（这几个接口是app-ios-weixin-support.js需要的），提供本文件可免去修改app.js源码。\r\n此文件需要在app.js之前进行加载，【注意】【本文件需要修改后才能用到你的网站】\r\nhttps://github.com/xiangyuecn/Recorder\r\n*/\r\n(function () {\r\n   \"use strict\";\r\n   /**【需修改】请使用自己的js文件目录，不要用github的不稳定。RecordApp会自动从这个目录内进行加载相关的实现文件、Recorder核心、编码引擎，会自动默认加载哪些文件，请查阅app.js内所有Platform的paths配置；如果这些文件你已手动全部加载，这个目录配置可以不用**/\r\n   window.RecordAppBaseFolder = window.PageSet_RecordAppBaseFolder || \"/src/\";\r\n   /**【需修改】请使用自己的微信JsSDK签名接口、素材下载接口，不能用这个，微信【强制】要【绑安全域名】，别的站用不了。下面ajax相关调用的请求参数、和响应结果格式也需要调整为自己的格式。\r\n   后端签名接口参考文档：微信JsSDK wx.config需使用到后端接口进行签名，文档: https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html 阅读：通过config接口注入权限验证配置、附录1-JS-SDK使用权限签名算法\r\n   后端素材下载接口参考文档: https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1444738727\r\n   **/\r\n   console.log('支持文件加载')\r\n   var MyWxApi = window.PageSet_RecordAppWxApi || \"这里可以改\"; /*本例子提供的这个api接口：\r\n            会实现两个功能，ajax POST请求参数如下(都是两个参数，完整细节看下面ajax调用):\r\n               功能一、\r\n                  action=\"sign\" //JsSDK签名\r\n                  url=\"https://x.com/page\" //当前页面url地址,需要对这个地址进行签名\r\n               功能二、\r\n                  action=\"wxdown\" //素材下载\r\n                  mediaID=\"abcd\" //需下载的素材ID\r\n            响应内容(JSON Object):\r\n               {\r\n                  c:0\t\t//code，0：正常，其他：错误\r\n                  ,m:\"\"\t//errMsg code!=0时的错误描述\r\n                  ,v:{}\t//返回结果value，为JSON Object\r\n                        //sign时:v={appid:\"\", timestamp:\"\", noncestr:\"\", signature:\"\"} 就是返回wx.config需要的签名相关参数\r\n                        //wxdown时:v={mime:\"audio/amr\", data:\"base64文本\"} 就是返回素材下载的音频文件base64编码数据\r\n               }*/\r\n   /******END******/ \r\n   //Install Begin：在RecordApp准备好时执行这些代码\r\n   window.OnRecordAppInstalled = window.IOS_Weixin_RecordApp_Config = function () {\r\n      console.log(\"ios-weixin-config install\");\r\n      window.IOS_Weixin_RecordApp_Config = null;\r\n      window.Native_RecordApp_Config && Native_RecordApp_Config();//如果native-config.js也引入了的话，也需要初始化\r\n      var App = RecordApp;\r\n      var platform = App.Platforms.Weixin;\r\n      var config = platform.Config;\r\n      var win = window.top;//微信JsSDK让顶层去加载，免得iframe各种麻烦\r\n      /*********实现app.js内IOS-Weixin中Config的接口*************/\r\n      config.Enable = function (call) {\r\n         //是否启用微信支持，默认启用，如果要禁用就回调call(false)\r\n         call(true);\r\n      };\r\n      config.WxReady = function (call) {\r\n         //此方法已实现在微信JsSDK wx.config好后调用call(wx,err)函数\r\n         //微信JsSDK wx.config需使用到后端接口进行签名，文档： https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html 阅读：通过config接口注入权限验证配置、附录1-JS-SDK使用权限签名算法\r\n         if (!win.WxReady) {\r\n            win.eval(\"var InitJsSDK=\" + InitJsSDK.toString() + \";InitJsSDK\")(App, MyWxApi, ajax);\r\n         };\r\n         win.WxReady(call);\r\n      };\r\n      config.DownWxMedia = function (param, success, fail) { \r\n         /*下载微信录音素材，服务器端接口文档： https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1444738727\r\n         param:{//接口调用参数\r\n            mediaId：\"\" 录音接口上传得到的微信服务器上的ID，用于下载单个素材（如果录音分了多段，会循环调用DownWxMedia）；如果服务器会进行转码，请忽略这个参数\r\n            transform_mediaIds:\"mediaId,mediaId,mediaId\" 1个及以上mediaId，半角逗号分隔，用于服务器端进行转码用的，正常情况下这个参数用不到。如果服务器端会进行转码，需要把这些素材全部下载下来，然后按顺序合并为一个音频文件\r\n            transform_type:\"mp3\" 录音set中的类型，用于转码结果类型，正常情况下这个参数用不到。如果服务器端会进行转码，接口返回的mime必须是：audio/type(如：audio/mp3)。\r\n            transform_bitRate:123 建议的比特率，转码用的，同transform_type\r\n            transform_sampleRate:123 建议的采样率，转码用的，同transform_type \r\n            * 素材下载的amr音质很渣，也许可以通过高清接口获得清晰点的speex音频，那么transform_*参数就有用武之地；直接下载的amr只需用mediaId参数就可以了。\r\n         }\r\n         success： fn(obj) 下载成功返回结果\r\n            obj:{\r\n               mime:\"audio/amr\" //这个值是服务器端请求临时素材接口返回的Content-Type响应头，未转码必须是audio/amr；如果服务器进行了转码，是转码后的类型mime，并且提供duration\r\n               ,data:\"base64文本\" //服务器端下载到或转码的文件二进制内容进行base64编码 \r\n               ,duration:0 //音频时长，如果服务器端进行了转码，必须返回这个参数并且>0，否则不要提供或者直接给0\r\n            }\r\n         fail: fn(msg) 下载出错回调\r\n         */\r\n         ajax(MyWxApi, {\r\n            action: \"wxdown\"\r\n            , mediaID: param.mediaId\r\n         }, function (data) {\r\n            console.log(data);\r\n            //   下载回调\r\n            success(data);\r\n         }, function (msg) {\r\n            fail(\"下载音频失败：\" + msg);\r\n         });\r\n      };\r\n      /*********接口实现END*************/ \r\n      var ajax = function (url, data, True, False) {\r\n         var xhr = new XMLHttpRequest();\r\n         xhr.timeout = 20000;\r\n         xhr.open(\"POST\", url);\r\n         xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4) {\r\n               if (xhr.status == 200) {\r\n                  var o = JSON.parse(xhr.responseText);\r\n                  if (o.c) {\r\n                     False(o.m);\r\n                     return;\r\n                  };\r\n                  True(o);\r\n               } else {\r\n                  False(\"请求失败[\" + xhr.status + \"]\");\r\n               }\r\n            }\r\n         };\r\n         var arr = [];\r\n         for (var k in data) {\r\n            arr.push(k + \"=\" + encodeURIComponent(data[k]));\r\n         };\r\n         xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n         xhr.send(arr.join(\"&\"));\r\n      };\r\n      /*********JsSDK*************/\r\n      var InitJsSDK = function (App, MyWxApi, ajax) {\r\n         var wxOjbK = function (call) {\r\n            if (errMsg) {\r\n               call(null, errMsg);\r\n               return;\r\n            }; \r\n            wxConfig(function () {\r\n               call(wx);\r\n            }, function (msg) {\r\n               call(wx, \"请求微信接口失败: \" + msg);\r\n            });\r\n         }; \r\n         //微信环境准备完毕\r\n         window.WxReady = function (call) {\r\n            if (isReady) {\r\n               wxOjbK(call);\r\n            } else {\r\n               calls.push(call);\r\n            };\r\n         };\r\n         var isReady = false;\r\n         var calls = [];\r\n         var errMsg = \"\";\r\n\r\n         var jsEnd = function () {\r\n            isReady = true;\r\n            var arr = calls;\r\n            calls = [];\r\n            for (var i = 0; i < arr.length; i++) {\r\n               wxOjbK(arr[i]);\r\n            };\r\n         };\r\n         App.Js([{ url: \"https://res.wx.qq.com/open/js/jweixin-1.4.0.js\", check: function () { return !window.wx || !wx.config } }], function () {\r\n            console.log(\"weixin jssdk加载好了\");\r\n            jsEnd();\r\n         }, function (msg) {\r\n            errMsg = \"加载微信JsSDK失败，请刷新页面：\" + msg;\r\n            console.error(\"weixin jssdk加载失败:\" + msg);\r\n            jsEnd();\r\n         }, window); \r\n         //等等完成签名\r\n         var wxConfigStatus = 0;\r\n         var wxConfigErr = \"\";\r\n         var wxConfigCalls = [];\r\n         var wxConfig = function (True, False) {\r\n            if (wxConfigStatus == 6) {\r\n               True();\r\n               return;\r\n            } else if (wxConfigStatus == 5) {\r\n               False(wxConfigErr);\r\n               return;\r\n            };\r\n            wxConfigCalls.push({ t: True, f: False });\r\n            var end = function (err) {\r\n               if (wxConfigStatus < 5) {\r\n                  wxConfigErr = err ? \"微信config失败，请刷新页面重试：\" + err : \"\";\r\n                  wxConfigStatus = err ? 5 : 6;\r\n                  for (var i = 0; i < wxConfigCalls.length; i++) {\r\n                     var o = wxConfigCalls[i];\r\n                     if (err) {\r\n                        o.f(wxConfigErr);\r\n                     } else {\r\n                        o.t();\r\n                     };\r\n                  };\r\n               };\r\n            };\r\n            if (wxConfigStatus != 0) {\r\n               return;\r\n            };\r\n            wxConfigStatus = 1;\r\n            // 这里可以改\r\n            var config = function (data) {\r\n               wx.config({\r\n                  debug: false\r\n                  , appId: data.appid\r\n                  , timestamp: data.timestamp\r\n                  , nonceStr: data.nonceStr\r\n                  , signature: data.signature\r\n                  , jsApiList: (\"getLocation\"\r\n                     + \",startRecord,stopRecord,onVoiceRecordEnd\"\r\n                     + \",playVoice,pauseVoice,stopVoice,onVoicePlayEnd\"\r\n                     + \",uploadVoice,downloadVoice\"\r\n                  ).split(\",\")\r\n               });\r\n               wx.error(function (res) {\r\n                  end(res.errMsg);\r\n               });\r\n               wx.ready(function () {\r\n                  console.log(\"微信JsSDK签名配置完成\");\r\n                  end();\r\n               });\r\n            };\r\n            ajax(MyWxApi, {\r\n               action: \"sign\"\r\n               , url: encodeURIComponent(location.href.replace(/#.*/g, \"\"))\r\n            }, function (data) { \r\n               config(data);\r\n            }, end);\r\n         };\r\n      };\r\n\r\n\r\n\r\n   };\r\n   //Install End \r\n   //如果已加载RecordApp，手动进行触发\r\n   if (window.RecordApp) {\r\n      OnRecordAppInstalled();\r\n   };\r\n\r\n})();\r\n\r\n\r\n\r\n\r\nconsole.error(\"【注意】本网站正在使用RecordApp的ios-weixin-config.js测试用的配置例子，这个配置如果要使用到你的网站，需要自己重写或修改后才能使用\");\r\n//别的站点引用弹窗醒目提示\r\nif (!/^file:|:\\/\\/[^\\/]*(jiebian.life|github.io)(\\/|$)/.test(location.href)\r\n   && !localStorage[\"DisableAppSampleAlert\"]\r\n   && !window.AppSampleAlert) {\r\n   window.AppSampleAlert = 1;\r\n   // alert(\"【注意】当前网站正在使用RecordApp测试用的配置例子*.config.js，需要自己重写或修改后才能使用\");\r\n};"],"sourceRoot":""}